# DeBix (Deobfuscator Bitrix)

Утилита для деобфускации кода **Bitrix** и других обфусцированных PHP-скриптов. Инструмент предназначен для восстановления читаемости кода путем автоматизации процесса распознавания переменных, очистки функций и форматирования.

## Основные возможности

- **Деобфускация**: Файлы модифицируются непосредственно в их оригинальном расположении.
- **Автоматический бекап**: Создает ZIP-архив всех файлов проекта перед началом обработки.
- **ОколоИнтеллектуальный поиск**: Автоматически находит обфусцированные файлы в указанной директории проекта.
- **Очистка переменных**: Распознает и заменяет обфусцированные названия переменных на их реальные значения, извлеченные из глобальных массивов.
- **Обработка функций**: Раскрывает обфусцированные вызовы функций через глобальные массивы.
- **Обучение на коде**: Анализирует структуру кода для автоматического сопоставления паттернов.
- **Специально для Bitrix**: Специализированные паттерны для обфускации, часто встречающейся в модулях Bitrix.
- **Форматирование кода**: Применяет базовое форматирование для улучшения читаемости.

## Требования

- PHP 8.3 или выше
- Утилита grep (доступная в системном окружении)
- Расширение PHP zip (для создания бекапов)

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/FaLLenSk1LL/DeBix.git
   ```

2. Перейдите в директорию проекта:
   ```bash
   cd DeBix
   ```

## Использование

Запустите инструмент через CLI, указав путь к директории вашего проекта:

```bash
php DeBix.php /путь/к/вашему/проекту
```

Если путь не указан в аргументах, инструмент запросит его при запуске.

### Запуск через Docker (Рекомендуется)

Для обеспечения изоляции и безопасности при работе с подозрительным кодом рекомендуется использовать Docker:

1. **Соберите образ**:
   ```bash
   docker compose build
   ```

2. **Запустите деобфускацию**:
   Укажите путь к вашему проекту в переменной окружения `PROJECT_PATH`:
   ```bash
   PROJECT_PATH=/путь/к/вашему/проекту docker compose run debix
   ```
   *По умолчанию проект ищется в папке `./project` относительно корня DeBix.*
   
### Процесс работы

1. **Сканирование**: Инструмент рекурсивно ищет PHP-файлы с признаками обфускации в указанной директории.
2. **Бекап**: Создается ZIP-архив всех найденных файлов (например, backup_2024-02-26_12-00-00.zip).
3. **Обработка**: Каждый файл деобфусцируется пошагово.
4. **Маппинг**: Найденные соответствия переменных сохраняются в deobfuscation_map.php для последующего использования.

## Конфигурация

Вы можете изменить настройки в классе DeobfuscationConfig внутри DeBix.php:

- repeater_count: Количество циклов обработки для глубоко обфусцированного кода.
- mappings_file: Путь к файлу с базой сопоставлений (по умолчанию deobfuscation_map.php).
- custom_mappings_file: Путь к вашим собственным сопоставлениям.
- max_file_size_mb: Максимальный размер файла для обработки.
- enable_backup: Включение/выключение автоматического бекапа.
- format_output: Включение/выключение форматирования результирующего кода.

## Структура проекта

- DeBix.php: Основной скрипт инструмента.
- deobfuscation_map.php: (Генерируется автоматически) База данных соответствий обфусцированных данных.
- custom_mappings.php: (Опционально) Файл для ваших ручных правил замены.

## Крайне важно!

Инструмент **выполняет eval()** для некоторых блоков кода, чтобы иметь возможность их парсить. Используйте инструмент только с кодом, которому вы доверяете. А лучше, запускайте всё в песочнице.

## Автор

@FaLLenSkiLL
